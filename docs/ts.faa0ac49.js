parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"/3NN":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,i,o,s){this.name=t,this.suffix=i,this.program=o,this.gl=s,this.location=s.getUniformLocation(o,t)}return t.prototype.set=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var o="uniform"+this.suffix,s=[this.location].concat(t);this.gl[o].apply(this.gl,s)},t}();exports.default=t;
},{}],"u7YK":[function(require,module,exports) {
"use strict";function n(n){return new Promise(function(e,r){var o=new Image;o.crossOrigin="Anonymous",o.addEventListener("load",function(n){e(o)},!1),o.addEventListener("error",function(n){r(n)}),o.src=n})}exports.__esModule=!0,exports.loadImg=n;
},{}],"FTgL":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(a,i){function o(t){try{l(r.next(t))}catch(e){i(e)}}function u(t){try{l(r.throw(t))}catch(e){i(e)}}function l(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(o,u)}l((r=r.apply(t,e||[])).next())})},e=this&&this.__generator||function(t,e){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(u){i=[6,u],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};exports.__esModule=!0;var n=require("./utils"),r=0,a=255;function i(r,a){return void 0===r&&(r="./img/cat.jpg"),void 0===a&&(a=10),t(this,void 0,Promise,function(){var t,i,o,u,l,c,s,h,f,p,d,g;return e(this,function(e){switch(e.label){case 0:return t=document.createElement("canvas"),i=t.getContext("2d"),[4,n.loadImg(r)];case 1:for(o=e.sent(),t.width=o.naturalWidth,t.height=o.naturalHeight,i.filter="blur("+a+"px)",i.drawImage(o,0,0,t.width,t.height),u=i.getImageData(0,0,t.width,t.height),l=u.data,c=0,s=l.length;c<s;c+=4)h=l[c+0],f=l[c+1],p=l[c+2],d=l[c+3],g=d?Math.floor((h+f+p)/3):0,l[c+0]=g,l[c+1]=g,l[c+2]=g;return i.putImageData(u,0,0),[2,t]}})})}exports.createDepth=i;
},{"./utils":"u7YK"}],"qi7O":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,i,e,s){return new(e||(e=Promise))(function(n,h){function r(t){try{a(s.next(t))}catch(i){h(i)}}function o(t){try{a(s.throw(t))}catch(i){h(i)}}function a(t){t.done?n(t.value):new e(function(i){i(t.value)}).then(r,o)}a((s=s.apply(t,i||[])).next())})},i=this&&this.__generator||function(t,i){var e,s,n,h,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return h={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function o(h){return function(o){return function(h){if(e)throw new TypeError("Generator is already executing.");for(;r;)try{if(e=1,s&&(n=2&h[0]?s.return:h[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,h[1])).done)return n;switch(s=0,n&&(h=[2&h[0],n.value]),h[0]){case 0:case 1:n=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,s=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(!(n=(n=r.trys).length>0&&n[n.length-1])&&(6===h[0]||2===h[0])){r=0;continue}if(3===h[0]&&(!n||h[1]>n[0]&&h[1]<n[3])){r.label=h[1];break}if(6===h[0]&&r.label<n[1]){r.label=n[1],n=h;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(h);break}n[2]&&r.ops.pop(),r.trys.pop();continue}h=i.call(t,r)}catch(o){h=[6,o],s=0}finally{e=n=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,o])}}},e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};exports.__esModule=!0;var s=e(require("./Uniform")),n=require("./utils"),h=require("./createDepth"),r=function(){function e(t){var i=t.canvas,e=t.vertexShaderSource,n=t.fragmentShaderSource,h=t.imgSrc,r=t.blur,o=void 0===r?10:r;this.vTh=35,this.hTh=10,this.dx=0,this.dy=0,this.blur=o,this.imgSrc=h,this.canvas=i,this.glContext=this.canvas.getContext("webgl"),this.winWidth=window.innerWidth,this.winHeight=window.innerHeight,this.canvas.width=this.winWidth,this.canvas.height=this.winHeight,this.program=this.glContext.createProgram(),this.addShader(e,this.glContext.VERTEX_SHADER),this.addShader(n,this.glContext.FRAGMENT_SHADER),this.glContext.linkProgram(this.program),this.glContext.useProgram(this.program),this.uResolution=new s.default("resolution","4f",this.program,this.glContext),this.uMouse=new s.default("mouse","2f",this.program,this.glContext),this.uTime=new s.default("time","1f",this.program,this.glContext),this.uRatio=new s.default("pixelRatio","1f",this.program,this.glContext),this.uThreshold=new s.default("threshold","2f",this.program,this.glContext);var a=this.glContext.createBuffer();this.glContext.bindBuffer(this.glContext.ARRAY_BUFFER,a),this.glContext.bufferData(this.glContext.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.glContext.STATIC_DRAW),this.positionLocation=this.glContext.getAttribLocation(this.program,"a_position"),this.glContext.enableVertexAttribArray(this.positionLocation),this.glContext.vertexAttribPointer(this.positionLocation,2,this.glContext.FLOAT,!1,0,0),this.uResolution.set(this.canvas.width,this.canvas.height,1,1),this.uRatio.set(1/this.ratio),this.uThreshold.set(this.hTh,this.vTh),this.glContext.viewport(0,0,this.canvas.width*this.ratio,this.canvas.height*this.ratio)}return e.prototype.bindTexture=function(){return t(this,void 0,Promise,function(){var t,e,s,n;return i(this,function(i){switch(i.label){case 0:return t=this,[4,this.createTexture()];case 1:return t.texture=i.sent(),console.log(this.texture),[4,this.createTexture(!0)];case 2:return e=i.sent(),s=this.glContext.getUniformLocation(this.program,"image0"),n=this.glContext.getUniformLocation(this.program,"image1"),this.glContext.uniform1i(s,0),this.glContext.uniform1i(n,1),this.glContext.activeTexture(this.glContext.TEXTURE0),this.glContext.bindTexture(this.glContext.TEXTURE_2D,this.texture),this.glContext.activeTexture(this.glContext.TEXTURE1),this.glContext.bindTexture(this.glContext.TEXTURE_2D,e),this.setup(),[2]}})})},e.prototype.render=function(){this.startTime||(this.startTime=(new Date).getTime());var t=((new Date).getTime()-this.startTime)/1e3;this.uTime.set(t),this.uMouse.set(this.dx,this.dy),this.glContext.drawArrays(this.glContext.TRIANGLE_STRIP,0,4)},e.prototype.addShader=function(t,i){var e=this.glContext.createShader(i);if(this.glContext.shaderSource(e,t),this.glContext.compileShader(e),!this.glContext.getShaderParameter(e,this.glContext.COMPILE_STATUS))throw new Error("error: "+this.glContext.getShaderInfoLog(e));this.glContext.attachShader(this.program,e)},e.prototype.createTexture=function(e){return void 0===e&&(e=!1),t(this,void 0,Promise,function(){var t,s,r;return i(this,function(i){switch(i.label){case 0:return e?[4,h.createDepth(this.imgSrc,this.blur)]:[3,2];case 1:return s=i.sent(),[3,4];case 2:return[4,n.loadImg(this.imgSrc)];case 3:s=i.sent(),i.label=4;case 4:return(t=s)instanceof Image&&(this.imageAspect=t.naturalHeight/t.naturalWidth),t.style.width="300px",document.querySelector(".wrapper").appendChild(t),r=this.glContext.createTexture(),this.glContext.bindTexture(this.glContext.TEXTURE_2D,r),this.glContext.texParameteri(this.glContext.TEXTURE_2D,this.glContext.TEXTURE_WRAP_S,this.glContext.CLAMP_TO_EDGE),this.glContext.texParameteri(this.glContext.TEXTURE_2D,this.glContext.TEXTURE_WRAP_T,this.glContext.CLAMP_TO_EDGE),this.glContext.texParameteri(this.glContext.TEXTURE_2D,this.glContext.TEXTURE_MIN_FILTER,this.glContext.LINEAR),this.glContext.texParameteri(this.glContext.TEXTURE_2D,this.glContext.TEXTURE_MAG_FILTER,this.glContext.LINEAR),this.glContext.texImage2D(this.glContext.TEXTURE_2D,0,this.glContext.RGBA,this.glContext.RGBA,this.glContext.UNSIGNED_BYTE,t),[2,r]}})})},e.prototype.setup=function(){this.winWidth=window.innerWidth,this.winHeight=window.innerHeight,this.ratio=window.devicePixelRatio,this.canvas.width=this.winWidth*this.ratio,this.canvas.height=this.winHeight*this.ratio,this.canvas.style.width=this.winWidth+"px",this.canvas.style.height=this.winHeight+"px",this.winHeight/this.winWidth<this.imageAspect?this.uResolution.set(this.winWidth,this.winHeight,1,this.winHeight/this.winWidth/this.imageAspect):this.uResolution.set(this.winWidth,this.winHeight,this.winWidth/this.winHeight*this.imageAspect,1),this.uRatio.set(1/this.ratio),this.glContext.viewport(0,0,this.winWidth*this.ratio,this.winHeight*this.ratio)},e}();exports.default=r;
},{"./Uniform":"/3NN","./utils":"u7YK","./createDepth":"FTgL"}],"dpJa":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\nattribute vec2 a_position;\n\nvoid main() {\n  gl_Position = vec4( a_position, 0, 1 );\n}\n";
},{}],"Oth3":[function(require,module,exports) {
module.exports="#ifdef GL_ES\n  precision mediump float;\n#define GLSLIFY 1\n#endif\n\nuniform vec4 resolution;\nuniform vec2 mouse;\nuniform vec2 threshold;\nuniform float time;\nuniform float pixelRatio;\nuniform sampler2D image0;\nuniform sampler2D image1;\n\nvec2 mirrored(vec2 v) {\n  vec2 m = mod(v,2.);\n  return mix(m,2.0 - m, step(1.0 ,m));\n}\n\nvoid main() {\n  // uvs and textures\n  vec2 uv = pixelRatio*gl_FragCoord.xy / resolution.xy ;\n  vec2 vUv = (uv - vec2(0.5))*resolution.zw + vec2(0.5);\n  vUv.y = 1. - vUv.y;\n  vec4 tex1 = texture2D(image1,mirrored(vUv));\n  vec2 fake3d = vec2(vUv.x + (tex1.r - 0.5)*mouse.x/threshold.x, vUv.y + (tex1.r - 0.5)*mouse.y/threshold.y);\n  gl_FragColor = texture2D(image0,mirrored(fake3d));\n}\n";
},{}],"LQOA":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,u){function i(e){try{l(r.next(e))}catch(t){u(t)}}function o(e){try{l(r.throw(e))}catch(t){u(t)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(i,o)}l((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,a,u,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function o(u){return function(o){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&u[0]?r.return:u[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,u[1])).done)return a;switch(r=0,a&&(u=[2&u[0],a.value]),u[0]){case 0:case 1:a=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!a||u[1]>a[0]&&u[1]<a[3])){i.label=u[1];break}if(6===u[0]&&i.label<a[1]){i.label=a[1],a=u;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(u);break}a[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(o){u=[6,o],r=0}finally{n=a=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,o])}}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};exports.__esModule=!0;var r,a=n(require("./Fake3D")),u=n(require("../shader/vertex.glsl")),i=n(require("../shader/fragment.glsl"));function o(){return e(this,void 0,Promise,function(){return t(this,function(e){switch(e.label){case 0:return[4,(r=new a.default({canvas:document.getElementById("canvas"),vertexShaderSource:u.default,fragmentShaderSource:i.default,imgSrc:"./img/cat.jpg",blur:30})).bindTexture()];case 1:return e.sent(),l(),[2]}})})}function l(){r.dx=.1*Math.cos((new Date).getTime()/800),r.dy=.7*Math.sin((new Date).getTime()/600),r.render(),requestAnimationFrame(l)}o();
},{"./Fake3D":"qi7O","../shader/vertex.glsl":"dpJa","../shader/fragment.glsl":"Oth3"}]},{},["LQOA"], null)
//# sourceMappingURL=ts.faa0ac49.js.map